<%= content_for :side_nav do %>
  <% @tracks.each_with_index do |track, i| %>
    <div class="bar-group">
      <div class="bar-header">
        <%= link_to track_path(track) do %>
          Module <%= i + 1 %> - <%= track.name %>
        <% end %>
      </div>
      <% track.lessons.order(:order).each do |lesson| %>
        <div class="bar-item <%= 'current' if lesson == @lesson %>">
          <%= link_to lesson_path(lesson) do %>
            <%= image_tag lesson.icon(lesson == @lesson ? nil : "grey"), :class => "bar-icon" %>
            <p class="bar-text">
              <%= lesson.lesson_type.capitalize %><% if lesson == @lesson %>&nbsp;- <%= lesson.description %><% end %>
            </p>
            <%= image_tag lesson.status_icon(current_user), :class => "bar-circle" %>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
<% end %>

<div class="top-section">
  <div class="row">
    <div class="top-column-main">
      <%= link_to track_path(@track) do %>
        <p class="header-back"><< LESSONS</p>
      <% end %>
      <h1 class="no-letter-spacing"><%= @lesson.lesson_type.capitalize.downcase.split(" ").map(&:capitalize).join(" ")  %></h1>

      <% if @lesson.completed?(current_user) %>
        <p class="header-info complete-btn completed">COMPLETED</p>
      <% else %>
        <%= form_for Progress.new do |f| %>
          <%= f.hidden_field :model_id, value: @lesson.id %>
          <%= f.submit "COMPLETE & CONTINUE", :class => "header-info complete-btn" %>
        <% end %>
      <% end %>
    </div><!-- column main -->
  </div><!-- row -->
</div>

<div class="column-main">
  <div class="lesson-container">
    <% if @lesson.video %>
      <iframe src="https://player.vimeo.com/video/48181711" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe> 

      <p class="video-title">
        <%= @lesson.video_title %>
      </p>
      <p class="video-author">
        <%= @lesson.video_author %>
      </p>
    <% end %>

    <% if @lesson.body %>
      <div class="lesson-body">
        <%= @lesson.body.html_safe %>
      </div>
    <% end %>

    <% if @lesson.discussion %>
      <%= form_for @comment, remote: true, :class => "main-comment" do |f| %>
        <%= f.text_area :body, :class => "comment-body", placeholder: "Ask a question..." %>
        <%= f.hidden_field :ama_id, value: @lesson.id %>
        <div class="comment-form-bottom">
          <div class="sort-bar">
            <p>Sort by:</p>
            <%= link_to lesson_path(id: @lesson.id, sort: "new") do %>
              <p class="<%= 'active' if @sort == "date" %> sort-item">New</p>
            <% end %>
            <%= link_to lesson_path(id: @lesson.id, sort: "top") do %>
              <p class="<%= 'active' if @sort == "top" %> sort-item">Top</p>
            <% end %>
          </div>
          <%= f.submit "Submit", :class => "submit-comment" %>
        </div>  
      <% end %>
       <div class="comments">
        <% @comments.each do |comment| %>
          <%= render partial: "comments/comment", locals: {comment: comment, commentable: @ama} %>
        <% end %>
      </div>
    <% end %>
  </div>
  


</div><!-- column-main -->
<div class="column-right">
</div>

<script>
  $('#side-nav').addClass('scrollable')
</script>