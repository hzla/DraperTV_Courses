<%= subscribe_to "/layouts/assignments" %>

<div class="top-section">
  <div class="top-column-main">
      <div style="width: 100%; position: relative; display; block; padding-left: 20px;">
          <h1><%= @assignment.title %></h1>
      </div>
  </div><!-- row -->
</div>

<div class="column-main">
  <div class="back" style="margin-left: 15px;">
      <%= link_to @assignment.course.title, course_path(@assignment.course) %>
    </div>
  <!-- split panel if speaker info available -->
  <div id="assignment_container">
    <!-- ******** VIDEO/FOUNDER ******* -->
    <% if @assignment.category == "video" or @assignment.category == "founder" %>
      <br/>

      <!-- ** completed assignment ** -->
      <% if @assignment.complete_for_user?(current_user) %>
      <%  @user_assignment = UserAssignment.where(:user_id => current_user[:id],:assignment_id => @assignment.id) %>
      <% if @user_assignment.first.complete == false %>

        <% track_activity_feed @user_assignment.first %>

       <% end %>
      <% @user_assignment.first.update_column(:complete, true) %>

        <div class="small-video-container">
          <div class="video-responsive-container">
            <%= raw @video_embed %>
          </div>
        </div>
        <div class="float-right-50">
          <h2><%= @assignment.question_text %></h2>
          <p class="minimize"><%= @assignment.question_duh_response %></p>
        </div>
        <br/><br/>
        <div class="line"></div>
        <div class="student-response">
          <div class="picture">
            <%= image_tag(current_user.avatar) %>
          </div>
          <div class="info">
            <div class="name"><%= current_user.full_name %></div>
            <% i = 0 %>
            <% r = @user_assignment.first.rating.to_i %>
            <% while i < r do %>
              <i class="fa fa-star"></i>
              <% i += 1 %>
            <% end %>
            <p class="response"><%= best_in_place @user_assignment.first, :question_response, :type => :textarea, :class => 'best_in_place' %></p>
            <!-- <p><a href="#complete-video-form" data-toggle="modal" data-backdrop="false">Edit Your Response</a></p> -->
          </div>
        </div>
        <div class="line"></div>
        <% @completed.each do |c| %>
          <div class="student-response">
            <div class="picture"><%= image_tag(User.find(c.user_id).avatar) %></div>
            <div class="info">
              <div class="name"><%= User.find(c.user_id).full_name %></div>
              <% i = 0 %>
              <% r = c.rating %>
              <% while i < r do %>
                <i class="fa fa-star"></i>
                <% i += 1 %>
              <% end %>
              <p class="response minimize"><%= c.question_response %></p>
            </div>
          </div>
        <% end %>

      <!-- ** not completed ** -->
      <% else %>
      <div class="video-responsive-container">
        <%= raw @video_embed %>
      </div>
       <div class="speaker-section">
          <%= image_tag(@assignment.speaker_pic) %>

          <div class="info">
             <a id="complete-video" class="button" data-toggle="modal" href="#complete-video-form" data-backdrop="false">Mark as Complete</a>

            <h2><%= @assignment.speaker_name %></h2>
            <p><%= @assignment.speaker_bio %></p>
          </div>
        </div><!-- speaker-section -->
      <% end %>

    <!-- ******** READING ******* -->
    <% elsif @assignment.category == "reading" %>
      <br/>
      <div class="video-responsive-container">
        <%= raw @video_embed %>
      </div>
      <div class="speaker-section">
        <%= image_tag(@assignment.speaker_pic) %>
        <div class="info">
          <h2><%= @assignment.speaker_name %></h2>
          <p><%= @assignment.speaker_bio %></p>
        </div>
      </div><!-- speaker-section -->

    <!-- ******** QUIZ ******* -->
    <% elsif @assignment.category == "quiz" %>
      <div class="quiz_description" style="min-height: 20px;"></div>

      <% if @assignment.survey.avaliable_for_participant?(current_user) %>
        <%= render 'quiz' %>
      <% else %>


        <div class="quiz-score">
        <% if @assignment.complete_for_user?(current_user) %>
          <%  @user_assignment = UserAssignment.where(:user_id => current_user[:id],:assignment_id => @assignment.id) %>
          <% if @user_assignment.first.complete == false %>
              <% track_activity_feed @user_assignment.first %>
           <% end %>
          <% @user_assignment.first.update_column(:complete, true) %>
         <% end %>

          You scored <%= @quiz_high_score %> out of <%= @quiz_total_questions %>
          <br />
          <br />
          <%= @quiz_ratio %>
          <br />
          <br />
          <!-- show quiz answers -->
          <div class="quiz-answers">
            <!-- <ul>
              <% @assignment.survey.questions.each_with_index do |question, index| %>
              <li>
                <p><%= question.text %></p>
                <% question.options.correct.each do |option| %>
                    <p class="correct"><%= option.text %></p>
                <% end %>
                <% question.options.incorrect.each do |option| %>
                    <p class="incorrect"><%= option.text %></p>
                <% end %>
             </li>
             <% end %>
            </ul> -->
          </div>
        </div>
      <% end %>
    <% end %>
    <%  @user_assignment = UserAssignment.where(:user_id => current_user[:id],:assignment_id => @assignment.id) %>
    <% if @assignment.require_upload == true %>
      <% if @assignment.user_assignments.where(:user_id => current_user[:id]).count > 0 %>
        <% if @user_assignment.first.text != nil %>

          <% if @user_assignment.first.complete == false %>
          <% track_activity_feed @user_assignment.first %>
         <% end %>
        <% @user_assignment.first.update_column(:complete, true) %>
          <div class="upload_show">
            <div class="upload_description">
              <table id="event-table" style="margin-top: 0px;">
                  <tr>
                    <td class="icon"><i class="fa fa-check-circle" style="color: #24b494"></i></td>
                    <td>Completed <%= @user_assignment.first.updated_at.strftime("%B %e") %></td>
                  </tr>
                  <tr>
                    <td class="icon"><i class="fa fa-align-justify"></i></td>
                    <td><% if @assignment.description != nil %><p class="minimize"><%= @assignment.description.html_safe %></p><% end %></td>
                  </tr>
                  <!-- <tr>
                    <td class="icon"><i class="fa fa-user"></i></td>
                    <td>Completed by Yad Faeq, Charles Taibi, Kelsey Whelan, and 6 more</td>
                  </tr> -->
                  <tr>
                    <td></td>
                    <td></td>
                  </tr>
                </table>
            </div>
            <div class ="section-bar" style="margin-bottom: 10px;">Response </div>
            <li role="menu"><%= link_to 'Edit',  edit_user_assignment_path(@user_assignment.first) %></li>

            <p><%= raw(@user_assignment.first.text) %></p>
            <br />
            <% if @assignment.category == "upload" %>
              <div class ="section-bar" style="margin-bottom: 10px; margin-top: 0;">Uploads</div>
            <% end %>
            <% if @user_assignment.first.link != nil %>
              <p><%= link_to "File Link", "#{@user_assignment.first.link}", target: "_blank", :class => "link-button-yellow" %></p><br/>
            <% end %>
            <br />
            <% if @user_assignment.first.upload_file_name != nil %>
              <% if @user_assignment.first.upload_content_type == 'image/jpeg' or @user_assignment.first.upload_content_type == 'image/png' or @user_assignment.first.upload_content_type == 'image/gif' %>
                <%= image_tag(@user_assignment.first.upload) %>
              <% elsif @user_assignment.first.upload_content_type == '' %>
              <% else %>
              <%= link_to "Download File", "#{@user_assignment.first.upload}", :class => "download-button-blue" %>
              <% end %>
            <% end %>
          </div>
        <% else %>
          <%= render 'upload' %>
        <% end %>
      <% end %>
    <% end %>

  </div> <!-- end span10 -->
</div> <!-- column-main -->

<!-- ************************************** -->
<!-- **** MARK AS COMPLETE MODAL FORM ***** -->
<!-- ************************************** -->
<%  @user_assignment = UserAssignment.where(:user_id => current_user[:id],:assignment_id => @assignment.id) %>

 <div id="complete-video-form" class="modal hide fade" tabindex="1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div style="padding: 30px;">
    <% if @user_assignment %>
      <%= form_for @user_assignment.first do |f| %>
        <button type="button" class="close" style="" data-dismiss="modal" aria-hidden="true">x</button>
        <h2>Complete <%= @assignment.title %></h2><br/>
        <div class="title">Please rate this lecture from one to five stars, where five is the best.</div>
        <fieldset class="rating">
          <%= f.radio_button("rating", 5,  id: "star5") %>
           <label for="star5" title="Rocks!">5 stars</label>
          <%= f.radio_button("rating", 4, checked: false, id: "star4") %>
          <label for="star4" title="Great">4 stars</label>
          <%= f.radio_button("rating", 3, checked: false, id: "star3") %>
          <label for="star3" title="Good">3 stars</label>
          <%= f.radio_button("rating", 2, checked: false, id: "star2") %>
          <label for="star2" title="OK">2 stars</label>
          <%= f.radio_button("rating", 1, checked: false, id: "star1") %>
          <label for="star1" title="meh">1 star</label>
        </fieldset>
        <div class="title"><%= @assignment.question_text %></div>
        <%= f.text_area :question_response, :label => false, :input_html => { :rows => 5, :minlength => 300, :style => "width: 95%;"}, :placeholder => "Your response must be at least 300 characters." %>
        <%= f.hidden_field :point_value, :value => 300 %>
        <%= f.hidden_field :complete, value: true %>
        <%= f.submit "Complete Assignment" %>
      <% end %>
    <% else %>
    <% end %>
  </div>
</div>

<!-- ************************ -->
<!-- **** COLUMN RIGHT  ***** -->
<!-- ************************ -->

<div class="column-right">
  <div class="col-right-top-section">
    <h3>Discussion</h3>
  </div>
  <div class="col-right-comments">
    <div id="comments_container">
      <div id="<%= @assignment.id %>">
        <%= render "user_comments/comments" %>
      </div>
    </div>
  </div><!-- col-right-comments -->
  <div class="col-right-addcomment">
    <%= render "user_comments/addsidenavcomment" %>
  </div><!-- col-right-addcomment -->
</div><!-- column-right -->

