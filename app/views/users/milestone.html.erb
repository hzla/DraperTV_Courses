<% @uas = UserAssignment.all %>
<% @as = Assignment.all %>
<% @estudents = User.pluck(:id) %>

<br>
<br>
<br>
<div class="slide">
<table class="table table-hover" id="studentstable">
  <tr>
  		<td>Student Name</td>
  		<td>Country</td>
  		 <td>Program</td>


  		<% @as.where(:category => "milestone").each do |assignment| %>
          <% course = Course.find_by_id(assignment.course_id) %>
			<td>

					<div class="name"><%= assignment.title %></div>


			</td>
        <% end %>

  </tr>
  	 <% @users.each do |user| %>
		<tr>
			<td><div class="name"><%= user.full_name %></div></td>
			<td><div class="name"><%= user.country %></div></td>
			<td><div class="name"></div></td>


        <% @as.where(:category => "milestone").each do |assignment| %>
        	<td class="hidetable">

		<% if UserAssignment.where(:assignment_id => assignment.id,:user_id => user.id ).blank? %>
		<% else %>
		<% if UserAssignment.where(:assignment_id => assignment.id,:user_id => user.id ).first.complete == false %>
			<% else %>
	      <% @user_assignment = UserAssignment.where(:assignment_id => assignment.id,:user_id => user.id).first %>
				<%= raw(@user_assignment.text) %>

				<div class="name"></div>
				</td>
		<% end %>
		<% end %>



        <% end %>


		</tr>
	<% end %>


</table>
<input type="button" onclick="$('#studentstable').table2CSV()" value="Report into CSV">
</div>

<script type="text/javascript" src="http://www.kunalbabre.com/projects/table2CSV.js" > </script>

<script type ="text/javascript">
  $(function() {
		$('.hidetable').find('table').remove();
  });
</script>
<style type="text/css">
	.slide
	{
    overflow-x: auto;
	}
	table, th, td
	{
	border: 1px solid black;
	}
	table
	{
	border-collapse:collapse;
	}
	table, th, td
	{
	border: 1px solid black;
	}

	table
	{
	width:100%;
	}
	th
	{
	height:50px;
	}

	td
	{
	text-align:right;
	}

	td
	{
	padding:15px;
	}
	table, td, th
	{
	border:1px solid green;
	}
	th
	{
	background-color:green;
	color:white;
	}
</style>
